title: $:/plugins/BTC/TiddlyFlex/KeyboardShortcuts/navigate-up
tags: $:/tags/KeyboardShortcut
key: ((navigate-up))

\import $:/plugins/BTC/TiddlyFlex/privates/selectors $:/plugins/BTC/TiddlyFlex/privates/navigation
\procedure actions-inner()
<%if [<nextTiddler>!is[blank]!match[]] %>
	<%if [<nextTiddler>is[draft]] %>
		<<tiddlyflex-focus-draft-tiddler>>
	<% else %>
		<<tiddlyflex-focus-flexcontainer>>
	<% endif %>
	<$action-navigate $to=<<nextTiddler>>/>
<% endif %>
\end
\define actions()
<%if [{$:/config/tiddlyflex/story-river/filter}match[yes]] %>
	<$set name="focusedTiddler" value={{{ [<historyList>get[current-tiddler]] }}}>
		<%if [list<storyList>search:$(searchFields)$:$(searchFlags)${$:/temp/search/input}match<focusedTiddler>] %>
			<$let nextTiddler={{{ [list<storyList>search:$(searchFields)$:$(searchFlags)${$:/temp/search/input}before<focusedTiddler>] ~[list<storyList>search{$:/temp/search/input}last[]] }}} cssEscapedTitle={{{ [<nextTiddler>escapecss[]] }}}>
				<<actions-inner>>
			</$let>
		<% else %>
			<$let nextTiddler={{{ [list<storyList>search:$(searchFields)$:$(searchFlags)${$:/temp/search/input}last[]] }}} cssEscapedTitle={{{ [<nextTiddler>escapecss[]] }}}>
				<<actions-inner>>
			</$let>
		<% endif %>
	</$set>
<% else %>
	<$let focusedTiddler={{{ [<historyList>get[current-tiddler]] }}} nextTiddler={{{ [list<storyList>before<focusedTiddler>] ~[list<storyList>last[]] }}} cssEscapedTitle={{{ [<nextTiddler>escapecss[]] }}}>
		<<actions-inner>>
	</$let>
<% endif %>
\end
<$vars searchFields={{{ [[$:/config/tiddlyflex/story-river/filter/fields]get[text]!is[blank]!match[]] ~[[tags,text,title]] }}} searchFlags={{{ [[$:/config/tiddlyflex/story-river/filter/flags]get[text]!is[blank]!match[]] ~[[words]] }}}>
	<$macrocall $name="tiddlyflex-keyboard-navigator" actions=<<actions>>/>
</$vars>